---
title: "R Notebook"
output: html_notebook
---
```{r echo=FALSE}
knitr::opts_chunk$set(eval=evaluate, cache=TRUE)
```

Identify any stations in `events.df` that are not found in `bay.df`.
```{r}
missing.taxa<- anti_join(events.df, bay.df, by = "station")
```

Import station information and apply `clean_up()`.
```{r}
lrr.station <- data.table::fread(file.path(project.dir, "data/station/LivingResourcesStationHUC8.csv"),
                            data.table = FALSE) %>% 
  clean_up()

```

`leaflet` is used to provide a visual reference and check of the data. The stations with event data are plotted as blue circles and the stations without event data are plotted as red circles. `jitter()` is used to alter the points position slightly, to prevent event data for the same station from completely overlapping one another.
```{r}
library(leaflet)
events.sub <- events.df %>% 
  select(catalogingunitdescription, source, latitude, longitude, station) %>% 
  filter(!is.na(latitude)) %>% 
  mutate(no_taxa_data = station %in% unique(missing.taxa$station),
         no_taxa_data = factor(no_taxa_data)) %>% 
  distinct() %>% 
  mutate(longitude = jitter(longitude, amount = 0.005),
         latitude = jitter(latitude, amount = 0.005))

factpal <- colorFactor(c("blue", "red"), events.sub$no_taxa_data)

leaflet(events.sub) %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addCircleMarkers( ~longitude, ~latitude,
                    color = ~factpal(no_taxa_data),
                    stroke = FALSE,
                    fillOpacity = 0.5,
                    popup = paste("Station:", events.sub$station, "<br/>",
                                  "Description:", events.sub$catalogingunitdescription, "<br/>",
                                  "Source:", events.sub$source, "<br/>",
                                  "Latitude:", events.sub$latitude, "<br/>",
                                  "Longitude:", events.sub$longitude),
                    popupOptions = popupOptions(style = list(color = "black")))

```
