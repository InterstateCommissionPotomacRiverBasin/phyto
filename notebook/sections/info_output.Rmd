---
title: "info_output_for_user"
author: "Luke Vawter"
date: "November 5, 2018"
output: html_document
---
```{r echo=FALSE}
knitr::opts_chunk$set(eval=evaluate, cache=cache.me)
```


```{r}
# test_station_tf.df <- phyto.df %>%
#   filter(str_detect(station, "tf"))
# 
# test_station_ret.df <- phyto.df %>%
#   filter(str_detect(station, "ret"))

```



L.V.: this is a modified version of prep_wq created for use with VA_ODU data. DO NOT USE THIS SECTION if you are pulling data from CEDR.  Use the master branch of phyto which uses prep_wq instead.


Phytoplankton sampling event data obtained from CEDR ([Download Monitoring Event]) is imported any rows that contain a `problem` flag are removed.
```{r}
wq.raw <- data.table::fread(file.path(project.dir, "data/water_quality/cedr_wq.csv"),
                            data.table = FALSE,
                           na.strings = c("")) %>% 
  filter(is.na(problem),
         parameter %in% c("chla", "doc", "pheo"))
```

The stations with water quality data are plotted using `leaflet`, to provide a visual reference and check of the data.
```{r}
stations.df <- wq.raw %>% 
  dplyr::select(station, agency, source, latitude, longitude) %>% 
  distinct() %>% 
  mutate(longitude = jitter(longitude, amount = 0.0005),
         latitude = jitter(latitude, amount = 0.0005))

leaflet(stations.df) %>% 
    addProviderTiles(providers$CartoDB.Positron,
                   options = leaflet::tileOptions(minZoom = 7, maxZoom = 18)) %>% 
  addCircleMarkers( ~longitude, ~latitude,
                    stroke = FALSE,
                    fillOpacity = 0.5,
                    popup = paste("Station:", stations.df$station, "<br/>",
                                  "Agency:", stations.df$agency, "<br/>",
                                  "Source:", stations.df$source, "<br/>",
                                  "Latitude:", stations.df$latitude, "<br/>",
                                  "Longitude:", stations.df$longitude)) %>% 
   leaflet::setMaxBounds(lng1 = -78, lat1 = 36, lng2 = -75, lat2 = 40.5) %>% 
  leaflet::setView(-76.4, lat = 38, zoom = 7) 
```


```{r}
wq.df <- wq.raw %>% 
  mutate(sampledate = as.Date(sampledate))
```

